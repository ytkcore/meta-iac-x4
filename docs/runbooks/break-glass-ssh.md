# Break-glass(비상 SSH 접속) 절차

이 저장소의 Bastion은 **SSM only(인바운드 0)** 전제로 설계되어 있습니다.  
그럼에도 불구하고 운영 중 “정말 어쩔 수 없는” 상황에서만, **임시로 SG를 수동 부착하여 SSH를 여는 절차**를 break-glass로 정의합니다.

## 전제
- 평상시:
  - Bastion 인스턴스에는 **SSH 인바운드가 없습니다.**
  - 접근은 **AWS Systems Manager Session Manager(SSM)** 로만 합니다.
- 비상 상황에만:
  - 제한된 시간 동안만, 승인된 운영자에 한해
  - “임시 SG”를 수동으로 붙여 SSH를 열고,
  - 작업이 끝나면 즉시 원복합니다.

## 권장 운영 규칙(조직 표준 예시)
1. 사전 승인(티켓/슬랙/전화 등) + 작업 범위 명시
2. 시간 제한(예: 30분/1시간)과 소스 IP 제한
3. 작업 로그 남김(명령어 로그, 변경 내역, 원인/조치)
4. 종료 후 **즉시 원복** + 사후 보고

## 절차
1) “임시 SG” 생성(또는 사전 준비된 SG 사용)
- 인바운드:
  - TCP 22
  - Source: 승인된 공인 IP(단일 IP 또는 매우 좁은 CIDR)
- 아웃바운드:
  - 최소 허용(기본은 all 허용이 일반적이지만 조직 정책에 따름)

2) Bastion 인스턴스에 임시 SG 수동 부착
- 기존 SSM용 SG는 유지하고, **임시 SG를 추가로 attach**

3) SSH 접속 및 필요한 작업 수행
- 작업은 최소화, 필요한 로그 남김

4) 원복
- 임시 SG detach(필수)
- 임시 SG 삭제(또는 비활성/보관 정책 적용)

## 왜 Terraform로 “항상” 관리하지 않나?
- break-glass는 “정상 운영 경로”가 아니라 **예외/비상 경로**입니다.
- Terraform에 상시 반영하면, 기본 설계 원칙(SSM only)이 흔들리고
  오히려 실수로 SSH가 상시 열릴 위험이 커집니다.
