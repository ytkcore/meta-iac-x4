version: '3.8'

networks:
  db-bridge:
    driver: bridge

services:
  postgres:
    image: my-harbor.local/library/postgres:17-alpine
    container_name: postgres-standalone
    restart: always
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-ChangeMe123!}
      POSTGRES_DB: meta_db
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256"
      POSTGRES_HOST_AUTH_METHOD: scram-sha-256
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      # - ./config/postgres/pg_hba.conf:/var/lib/postgresql/data/pg_hba.conf
      # postgresql.conf can also be mounted if needed, or configured via args
    networks:
      - db-bridge
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G

  neo4j:
    image: my-harbor.local/library/neo4j:5.26-enterprise
    container_name: neo4j-standalone
    restart: always
    environment:
      NEO4J_ACCEPT_LICENSE_AGREEMENT: "yes"
      NEO4J_AUTH: neo4j/${NEO4J_PASSWORD:-initialInfo123!}
      NEO4J_dbms_security_auth__enabled: "true"
      # Enforce password change is default behavior for initial auth
    ports:
      - "7474:7474" # HTTP
      - "7687:7687" # Bolt
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
      - ./config/neo4j/neo4j.conf:/conf/neo4j.conf
    networks:
      - db-bridge
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G

volumes:
  postgres_data:
  neo4j_data:
  neo4j_logs:
